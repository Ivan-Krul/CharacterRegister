<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../style/main.css">
    <link rel="stylesheet" href="../style/post.css">
    <title>Post Scrapper in Character Register</title>
</head>

<body>
    <div id="sideMenu">
        <h2>Side Menu</h2>
        <ul id="linkList">
            <li><a href="../index.html">Home</a></li>
            <li><a href="./post_scrapper.html">Post Scrapper</a></li>
            <li><a href="./about.html">About</a></li>
        </ul>
        <div id="externalFooter"></div>
    </div>

    <div id="content">
        <h2 id="header">Post Scrapper</h2>
        <a href="post_scrapper.html">back</a><br />
        <div id="post"></div>
        <img src="../resource/Circulator.gif">
    </div>

    <button id="toggleButton">Toggle Menu</button>
    <button id="toggleTheme">Toggle Theme</button>
    <script src="./../js/side_handler.js"></script>
    <script src="./../js/footer_generator.js"></script>
    <script src="./../js/dark_theme.js"></script>
    <script src="./../js/oc_linker.js"></script>
    <script src="./../js/post_generator.js"></script>
    <script>
        (async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const post = urlParams.get('post');

            if (post !== null) {
                if (post !== "") {
                    let page = "";
                    try {
                        page = printPostPage(await fetchFile("posts/" + post), post);
                        if (page.split("Eek").length === 1) {
                            let resPage = page.replaceAll("image/", "../image/");

                            document.getElementById("post").innerHTML = resPage;
                        }
                        else 
                            throw "[Eek]";
                    }
                    catch (error) {
                        if(Math.random() < 0.5)
                            document.getElementById("post").innerHTML = error + "<br/><video src=\"../resource/knife style.mp4\" autoplay controls style=\"max-width: 50vw; max-height: 50vh\"></video>";
                        else
                            document.getElementById("post").innerHTML = error + "<br/><video src=\"../resource/wrecked.mp4\" autoplay controls style=\"max-width: 50vw; max-height: 50vh\"></video>";
                    }
                }
                else {
                    document.getElementById("post").innerHTML = "[allocated]<br/><video src=\"../resource/Eek.mp4\" autoplay controls></video>";
                }
            }
            else {
                document.getElementById("header").innerText += " Browser";
                let partitions = await fetchFile("posts/partitions.txt");
                partitionsArray = partitions.split("\n");

                partitionsArray.forEach(element => {
                    let el = document.createElement("a");
                    el.href = "post_scrapper.html?post=" + element;
                    el.innerText = "post_scrapper.html?post=" + element;
                    document.getElementById("post").appendChild(el).appendChild(document.createElement("br"));
                });
            }
        })();
    </script>
</body>

</html>